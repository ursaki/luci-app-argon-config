name: Build luci-app-argon-config APK

on:
  workflow_dispatch:  # Permite rulare manuală
  push:
    branches: [ main, master ]

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        arch:
          - aarch64_cortex-a53
          - arm_cortex-a9
          - mips_24kc
          - x86_64
          # Adaugă aici arhitectura ta! Rulează 'cat /etc/apk/arch' pe router

    name: Build for ${{ matrix.arch }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Prepare build environment
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential clang flex bison g++ gawk \
          gcc-multilib g++-multilib gettext git libncurses-dev libssl-dev \
          python3-distutils rsync unzip zlib1g-dev file wget qemu-utils

      - name: Build APK package
        uses: openwrt/gh-action-sdk@v6
        env:
          ARCH: ${{ matrix.arch }}
          CONFIG_USE_APK: y
        with:
          target: ${{ matrix.arch }}/generic
          config: |
            CONFIG_USE_APK=y
            CONFIG_PACKAGE_luci-app-argon-config=y

      - name: Upload APK package
        uses: actions/upload-artifact@v4
        with:
          name: luci-app-argon-config-${{ matrix.arch }}
          path: bin/packages/**/*.apk
          if-no-files-found: warn
